---
title: 指针 + 函数
categories: 
- C
tags: 
- C
---

## 一、函数指针

### 1、什么是函数指针？
1. 回顾：int *类型的变量p，是指向int整数的指针变量。它存储的是int整数的地址；

2. 函数指针fp就是指向函数f的指针变量。它存储的是f函数的地址；

3. 函数也是有地址的，函数实际上由载入内存的一些指令组成，而指向函数的指针存储了函数指令的起始地址。

<!--more-->

### 2、声明
1. 函数声明：int func(int, int);

2. 函数指针声明：int (*fp) (int, int);

### 3、赋值
1. 举例
```C
#include <stdio.h>
#include <stdlib.h>
int show(int, int);
int main() {
 
    int x = 10;
    int y = 5;
    show(x, y);
 
    int (*fp)(int, int);
    printf("%d\n", sizeof(fp)); // 4
 
    printf("%d\n", fp);            // 未初始化，为0。类似于：指向数组的指针的初始化。
 
    fp = show;                     // 为函数指针fp赋值。函数名在使用的时候会被编译器转为函数指针。
    printf("%d\n", fp);            // 4200037
 
    int (*fp2)(int, int) = &show;  // 为函数指针fp2赋值。显式说明取show函数的地址。
    printf("%d\n", fp2);           // 4200037
  
    system("pause");
    return 0;
}
int show(int a, int b) {
    printf("%d %d\n", a, b);  // 10 5
    return a + b;
}
```

2. 使用typedef
```C
#include <stdio.h>
#include <stdlib.h>
int show(int, int);
int main() {
 
    int x = 10;
    int y = 5;
    show(x, y);
 
    int (*fp)(int, int) = show;          // 声明一个名为fp的函数指针变量，指向show。
 
    typedef int (*FP)(int, int);
 
    FP fp1 = &show;                      // 声明一个名为fp1的函数指针变量，指向show。
 
    printf("%d %d\n", sizeof(fp), sizeof(fp1));  // 4 4
    printf("%d %d\n", fp, fp1);                  // 4200013 4200013
  
    system("pause");
    return 0;
}
int show(int a, int b) {
    printf("%d %d\n", a, b);  // 10 5
    return a + b;
}
```

### 4、调用
1. 举例
```C
#include <stdio.h>
#include <stdlib.h>
int show(int, int);
int main() {
 
    int x = 10;
    int y = 5;
    show(x, y);
 
    typedef int (*FP)(int, int);
    FP fp1 = &show;                      // 声明一个名为fp1的函数指针变量，指向show
 
    fp1(x, y);                // 调用形式1
    (*fp1)(x, y);             // 调用形式2
  
    system("pause");
    return 0;
}
int show(int a, int b) {
    printf("%d %d\n", a, b);  // 10 5
    return a + b;
}
```

2. ANSI C认为这两种形式等价。

## 二、函数指针的作用

### 1、作为函数参数
1. 举例
```C
#include <stdio.h>
#include <stdlib.h>
 
#define STU_NAME_MAXLEN 16
 
typedef struct student_tag {
    unsigned int id;
    char name[STU_NAME_MAXLEN];
    float score;
} student;
 
int myCompare(const void *a, const void *b) {
    student *p1 = (student*)a;
    student *p2 = (student*)b;
    return p1->score - p2->score;
    // 返回值小于0，a排b左边。
    // 返回值等于0，不确定。
    // 返回值大于0，a排b右边。
}
 
int main() {
 
    student stus[3] = {{1, "Tom", 100.0f}, {2, "Kevin", 50.0f}, {3, "JJ", 120.0f}};
 
    qsort((void*)stus, 3, sizeof(student), myCompare);
 
    for (int i = 0; i <= 3 - 1; i++) {
        printf("%d %s %.2f\n", stus[i].id, stus[i].name, stus[i].score);
    }
 
    // 2 Kevin 50.00
    // 1 Tom 100.00
    // 3 JJ 120.00
  
    system("pause");
    return 0;
}
```

