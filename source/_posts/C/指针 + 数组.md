---
title: 指针 + 数组
categories: 
- C
tags: 
- C
---

## 一、一维数组

### 1、什么是数组？
1. 数组（Array）就是一些具有相同类型的数据的集合，这些数据在内存中依次挨着存放，彼此之间没有缝隙。

2. 数组元素可以是基本数据类型，也可以是构造类型。

<!--more-->

### 2、声明
1. 若显式指定了数组大小为n，则占用内存空间为：n * sizeof(DataType)；
注：可指定大小为0；

2. 若没有显式指定数组大小，则需要给出初始化列表。编译器可以根据初始化列表中有多少个元素，为数组分配内存；

3. 举例
```C
#include <stdio.h>
#include <stdlib.h>
int main () {
 
    int arr1[0];
    int arr2[] = {};
    int arr3[5];
    int arr4[] = {1, 2, 3, 4, 5};
 
    printf("%d\n", sizeof(int));  // 4
 
    printf("%d\n", sizeof(arr1)); // 0
    printf("%d\n", sizeof(arr2)); // 0
    printf("%d\n", sizeof(arr3)); // 20
    printf("%d\n", sizeof(arr4)); // 20
 
    system("PAUSE");
    return 0;
}
```

### 3、初始化
1. 静态数组
假设已经显式指定了大小为n的静态数组。
若无初始化列表：则所有元素初始化为0值。
若有初始化列表，且大小为m。
m = 0：所有元素都初始化为0值。
0 < m <= n：前m个元素按照初始化列表的赋值，后n - m个元素初始化为0值。
m > n：编译错误。

2. 静态数组-举例
```C
#include <stdio.h>
#include <stdlib.h>
 
int gArr[10];
 
int main () {
 
    static int sArr[5] = {1, 2, 3};
 
    printf("%d\n", sizeof(int));  // 4
    printf("%d\n", sizeof(gArr)); // 40
    printf("%d\n", sizeof(sArr)); // 20
    
    for (int i = 0; i <= 10 - 1; i++) {
        printf("%d ", gArr[i]); // 0 0 0 0 0 0 0 0 0 0
    }
    printf("\n");
 
    for (int i = 0; i <= 5 - 1; i++) {
        printf("%d ", sArr[i]); // 1 2 3 0 0
    }
    printf("\n");
 
    system("PAUSE");
    return 0;
}
```

3. 自动数组
假设已经显式指定了大小为n的自动数组。
若无初始化列表：则所有元素初始化为【不确定值】。
若有初始化列表，且大小为m。
m = 0：所有元素都初始化为0值。
0 < m <= n：前m个元素按照初始化列表的赋值，后n - m个元素初始化为0值。
m > n：编译错误。

4. 自动数组-举例
```C
#include <stdio.h>
#include <stdlib.h> 
int main () {
 
    double dArr1[5];
    double dArr2[5] = {};
    double dArr3[5] = {3.1, 3.2, 3.3};
 
    printf("%d\n", sizeof(double));  // 8
    printf("%d\n", sizeof(dArr1));   // 40
    printf("%d\n", sizeof(dArr2));   // 40
    printf("%d\n", sizeof(dArr3));   // 40
    
    for (int i = 0; i <= 5 - 1; i++) {
        printf("%.2f ", dArr1[i]);  // 5个不确定值
    }
    printf("\n");
 
    for (int i = 0; i <= 5 - 1; i++) {
        printf("%.2f ", dArr2[i]);  // 5个0值
    }
    printf("\n");
 
    for (int i = 0; i <= 5 - 1; i++) {
        printf("%.2f ", dArr3[i]);  // 3.10 3.20 3.30 0.00 0.00
    }
    printf("\n");
 
    system("PAUSE");
    return 0;
}
```

### 4、数组名
1. 除了下面场景1、场景2中，数组名array的含义：
指向数组中第1个元素(array[0])的指针常量；指针类型与array[0]的类型相同；

2. 举例
```C
#include <stdio.h>
#include <stdlib.h> 
int main () {
 
    int array[5] = {1, 2, 3, 4, 5};
 
    printf("%d\n", sizeof(int));    // 4
    printf("%d\n", sizeof(array));  // 20
    printf("%d %d %d %d %d\n", &array[0], &array[1], &array[2], &array[3], &array[4]);  
    // 6422204 6422208 6422212 6422216 6422220
 
    printf("%d\n", array);
    // 6422204
 
    printf("%d\n", *array);
    // 1
  
    system("PAUSE");
    return 0;
}
```

3. 场景1：sizeof(array)，求出array数组一共占用多少空间。

4. 场景2：&array，指向数组的指针。

### 5、下标运算符
1. 本质上，下标运算符都是通过指针进行的。

2. 举例
```C
#include <stdio.h>
#include <stdlib.h> 
int main () {
 
    int array[5] = {100, 200, 300, 400, 500};
 
    printf("%d\n", sizeof(int));    // 4
    printf("%d\n", sizeof(array));  // 20
    printf("%d %d %d %d %d\n", array[0], array[1], array[2], array[3], array[4]);  
    // 100 200 300 400 500
 
    int *p = array;
 
    printf("%d\n", *(p + 1));         // 200
    printf("%d\n", *(array + 1));     // 200
    printf("%d\n", p[1]);             // 200
    printf("%d\n", array[1]);         // 200
 
    p++;
    p++;
    p++;
 
    printf("%d\n", *(p + 1));        // 500
    printf("%d\n", p[1]);            // 500
 
    printf("%d\n", *(p - 1));        // 300
    printf("%d\n", p[-1]);           // 300
 
    printf("%d\n", 3[array]);        // 400
    printf("%d\n", 1[p]);            // 500
 
    system("PAUSE");
    return 0;
}
```

### 6、数组和指针不相等
1. 数组是数组，指针是指针。
```C
#include <stdio.h>
#include <stdlib.h> 
int main () {
 
    int array[5] = {1, 2, 3, 4, 5};
    int *p = array;
 
    printf("%d\n", sizeof(array)); // array在内存中占用20个字节（int为4字节）
    printf("%d\n", sizeof(p));     // p在内存中只占用4个字节（32位）
 
    system("PAUSE");
    return 0;
}
```

2. 字符数组char str[]、指向字符串常量的char*指针
```C
#include <stdio.h>
#include <stdlib.h> 
int main () {
 
    char str[6] = "hello"; // 等价于：char str[6] = {'h', 'e', 'l', 'l', 'o', '\0'};
    char *p = "hello";
 
    printf("%d\n", sizeof(str));   // array在内存中占用6个字节（char为1字节）
    printf("%d\n", sizeof(p));     // p在内存中只占用4个字节（32位）
 
    printf("%s\n", str);     // hello
    printf("%s\n", &str[0]); // hello
    printf("%s\n", p);       // hello
 
    *(str + 0) = 'H';
 
    printf("%s\n", str);      // Hello
    printf("%s\n", &str[0]);  // Hello
    printf("%s\n", p);        // hello
 
    //*(p + 0) = 'H';         // 运行时错误。字符串常量存储在只读区，不允许修改；
 
    system("PAUSE");
    return 0;
}
```

### 7、一维数组作为函数参数
1. 数组名array作为函数参数时，其实就是指向array[0]的指针。

2. 在C语言中，是按照值传递的，指针也是如此。
实参：array。即指向array[0]的指针常量。值是array[0]在内存中的地址。
当进行函数调用时，拷贝一份实参的值，传递给形参。
形参：指向array[0]的指针变量。值同样也是array[0]在内存中的地址。

3. 注意：形参中的array是一个指针变量，指向允许变化。且其指向变化后不会对实参的指向有任何改变。
实参中的array是一个指针常量，指向不允许变化。

4. 举例
```C
#include <stdio.h>
#include <stdlib.h> 
//void show(int array[], int n) 
void show(int *array, int n) {
    for (int i = 0; i <= n - 1; i++) {
        printf("%d ", array);     // 6422204 6422208 6422212 6422216 6422220
        printf("%d \n", *array);  // 1 2 3 4 500
        array = array + 1;
    }
    printf("\n");
}
int main () {
 
    int array[5] = {1, 2, 3, 4, 500};
 
    printf("%d %d %d %d %d\n", array[0], array[1], array[2], array[3], array[4]);       // 1 2 3 4 500
    printf("%d %d %d %d %d\n", &array[0], &array[1], &array[2], &array[3], &array[4]);  // 6422204 6422208 6422212 6422216 6422220
    printf("%d\n", array);  // 6422204
 
    show(array, sizeof(array) / sizeof(int));
 
    system("PAUSE");
    return 0;
}
```

## 二、指针数组

### 1、什么是指针数组？
1. 对于整型数组int array[5]，它的每一个元素都是一个int整数。

2. 对于指针数组int* pArray[5]，它的每一个元素都是一个int*指针（地址）。

3. 举例
```C
#include <stdio.h>
#include <stdlib.h> 
int main () {
 
    int array[5] = {1, 2, 3, 4, 500};
 
    for (int i = 0; i <= 5 - 1; i++) {
        printf("%d ", array[i]);   // 1 2 3 4 500
    }
    printf("\n");
 
    int *pArray[5] = {NULL};
 
    for (int i = 0; i <= 5 - 1; i++) {
        printf("%d ", pArray[i]);  // 0 0 0 0 0
    }
    printf("\n");
 
    system("PAUSE");
    return 0;
}
```

### 2、用途-1：类多维数组的数据存储
1. 用途-1：类多维数组的数据存储
背景：假设现在有100个字符串，其中长度最大的为500，最小的为10。将这些字符串存到内存中。
方法1：采用一个100 * 500的二维数组来存储。char strings[100][500]。缺点：空间利用率不高。
方法2：采用指针数组来存储。

2. 举例
```C
#include <stdio.h>
#include <stdlib.h> 
void show(char **strings, int nums, int *lens) {
    for (int i = 0; i <= nums - 1; i++) {
        int curLen = *(lens + i);          // 读取lens数组的每个元素的值，类型都是int整数。
        printf("%d %2d:", i, curLen);
 
        char *curString = *(strings + i);  // 读取pArray数组的每个元素的值，类型都是char*。都是某个字符串首字母的地址；
        printf("%s\n", curString);         // 根据字符串首字母的地址，printf输出整个字符串。遇到'\0'就停止；
 
        for (int j = 0; j <= curLen - 1; j++) {
            printf("%c", *(curString + j));  // 根据字符串首字母的地址，以及该字符串的长度。逐一输出每个字符。
        }
        printf("\n");
    }
}
// 0 11:[hello haha][hello haha]
// 1 6:[world][world]
// 2 9:[yanruiqi][yanruiqi]
// 3 5:[zhen][zhen]
// 4 11:[piao][piao liang]
// 5 1:[][]
int main() {
 
    char string1[] = "hello haha";
    char string2[] = "world";
    char string3[] = "yanruiqi";
    char string4[] = "zhen";
    char string5[] = "piao\0liang";
    char string6[] = "";
 
    int lens[6] = {11, 6, 9, 5, 11, 1};
    
    char *pArray[6] = {string1, string2, string3, string4, string5, string6};
 
    show(pArray, 6, lens);    
 
    system("PAUSE");
    return 0;
}
```

### 3、指针数组作为函数参数
1. 回顾：一维数组int array[]作为函数实参时，实际传递的是指向array[0]的指针。形参是一个类型为int*的指针变量。

2. 当指针数组char * pArray[]作为函数实参时，实际传递的仍是指向pArray[0]的指针。形参是一个类型为char ** 的指针变量。

## 三、二维数组

### 1、二维数组存储形式
1. 二维数组在内存中，仍是连续存储的，且是一维的。

### 2、二维数组名
1. 类似地，二维数组名matrix在一般情况下，都是一个指向matrix[0]的指针常量。而matrix[0]是一个数组。
例如：int matrix[3][6] = {0};
【matrix】：是一个指向【一个包含6个整数的一维数组】的指针。指向第0行。
【matrix + 1】：也是一个指向【一个包含6个整数的一维数组】的指针。指向第1行。

2. 【*(matrix + 1)】：对上述指针进行间接访问，得到的是一个一维数组（大小为6、类型为int）。
而数组名的值是一个指针常量，指向数组的第一个元素。
所以这个表达式：是一个指向matrix[1][0]的int *指针。

3. 【*(matrix + 1) + 5】：指向matrix[1][5]的int *指针。

4. 【* (*(matrix + 1) + 5)】：对上述指针进行间接访问，得到一个int。即matrix[1][5]。

5. 举例
```C
#include <stdio.h>
#include <stdlib.h> 
int main () {
 
    int matrix[3][6] = {{1, 2, 3, 4, 5, 6}, {10, 11, 12, 13, 14, 15}, {20, 21, 22, 23}};
 
    // matrix在内存中的值：
    // 1  2  3  4  5  6 
    // 10 11 12 13 14 15
    // 20 21 22 23 0  0  [不确定值]
 
    printf("%d %d\n", sizeof(matrix), sizeof(int));  // 72 4
    
    for (int i = 0; i <= 3 - 1; i++) {
        for (int j = 0; j <= 6 - 1; j++) {
            printf("%d ", &matrix[i][j]);
        }
        printf("\n");
    }
 
    // matrix在内存中的地址：
    // 6422144 6422148 6422152 6422156 6422160 6422164
    // 6422168 6422172 6422176 6422180 6422184 6422188
    // 6422192 6422196 6422200 6422204 6422208 6422212  [6422216]
 
    printf("%d\n", matrix);         // 6422144
    printf("%d\n", matrix + 1);     // 6422168
    printf("%d\n", matrix + 2);     // 6422192
    printf("%d\n", matrix + 3);     // 6422216
 
    printf("%d\n", *(matrix + 1));         // 6422168
    printf("%d\n", *(matrix + 1) + 5);     // 6422188
    printf("%d\n", *(*(matrix + 1) + 5));  // 15
 
    system("PAUSE");
    return 0;
}
```

### 3、指向一维数组的指针
1. 声明：int (*p)[6]

2. 初始化：
p = NULL;
p = matrix;

3. 举例
```C
#include <stdio.h>
#include <stdlib.h> 
int main () {
 
    int matrix[3][6] = {{1, 2, 3, 4, 5, 6}, {10, 11, 12, 13, 14, 15}, {20, 21, 22, 23}};
 
    // matrix在内存中的值：
    // 1  2  3  4  5  6 
    // 10 11 12 13 14 15
    // 20 21 22 23 0  0  [不确定值]
 
    printf("%d %d\n", sizeof(matrix), sizeof(int));  // 72 4
    
    for (int i = 0; i <= 3 - 1; i++) {
        for (int j = 0; j <= 6 - 1; j++) {
            printf("%d ", &matrix[i][j]);
        }
        printf("\n");
    }
 
    // matrix在内存中的地址：
    // 6422144 6422148 6422152 6422156 6422160 6422164
    // 6422168 6422172 6422176 6422180 6422184 6422188
    // 6422192 6422196 6422200 6422204 6422208 6422212  [6422216]
 
    int (*p)[6];
    
    printf("%d\n", sizeof(p));         // 4
 
    printf("%d\n", p);                 // 未初始化，0
 
    p = matrix;
 
    printf("%d\n", p);               // 6422144
    printf("%d\n", p + 1);           // 6422168
    printf("%d\n", p + 2);           // 6422192
 
    system("PAUSE");
    return 0;
}
```

### 4、二维数组作为函数参数
1. 当二维数组int matrix[3][6]作为函数实参时，实际传递的仍是指向matrix[0]的指针。形参是一个类型为int (*p)[6]的指针变量。

2. 举例
```C
#include <stdio.h>
#include <stdlib.h> 
//void show(int p[][6], int rowCnt)
void show(int (*p)[6], int rowCnt) {
    for (int i = 0; i <= rowCnt - 1; i++) {
        int *array = *(p + i);
        for (int j = 0; j <= 6 - 1; j++) {
            printf("%d ", *(array + j));
        }
        printf("\n");
    }
}
int main() {
 
    int matrix[3][6] = {{1, 2, 3, 4, 5, 6}, {10, 11, 12, 13, 14, 15}, {20, 21, 22, 23}};
 
    // matrix在内存中的值：
    // 1  2  3  4  5  6 
    // 10 11 12 13 14 15
    // 20 21 22 23 0  0  [不确定值]
 
    printf("%d %d\n", sizeof(matrix), sizeof(int));  // 72 4
    
    for (int i = 0; i <= 3 - 1; i++) {
        for (int j = 0; j <= 6 - 1; j++) {
            printf("%d ", &matrix[i][j]);
        }
        printf("\n");
    }
 
    // matrix在内存中的地址：
    // 6422144 6422148 6422152 6422156 6422160 6422164
    // 6422168 6422172 6422176 6422180 6422184 6422188
    // 6422192 6422196 6422200 6422204 6422208 6422212  [6422216]
 
    show(matrix, 3);
 
    system("PAUSE");
    return 0;
}
```

## 四、传递二维数组给函数

### 1、传递一个【指针，指向一个一维数组（matrix[0]）本身】
1. 如上述三.4.2中的例子。

### 2、传递一个【指针，指向一个指针数组的第一个元素】
```C
#include <stdio.h>
#include <stdlib.h> 
void show(int **p, int rowCnt, int colCnt) {
    for (int i = 0; i <= rowCnt - 1; i++) {
        int *array = *(p + i);
        for (int j = 0; j <= colCnt - 1; j++) {
            printf("%d ", *(array + j));
        }
        printf("\n");
    }
}
int main() {
 
    int matrix[3][6] = {{1, 2, 3, 4, 5, 6}, {10, 11, 12, 13, 14, 15}, {20, 21, 22, 23}};
 
    // matrix在内存中的值：
    // 1  2  3  4  5  6 
    // 10 11 12 13 14 15
    // 20 21 22 23 0  0  [不确定值]
 
    printf("%d %d\n", sizeof(matrix), sizeof(int));  // 72 4
    
    for (int i = 0; i <= 3 - 1; i++) {
        for (int j = 0; j <= 6 - 1; j++) {
            printf("%d ", &matrix[i][j]);
        }
        printf("\n");
    }
 
    // matrix在内存中的地址：
    // 6422144 6422148 6422152 6422156 6422160 6422164
    // 6422168 6422172 6422176 6422180 6422184 6422188
    // 6422192 6422196 6422200 6422204 6422208 6422212  [6422216]
 
    int *pArray[3] = {&matrix[0][0], &matrix[1][0], &matrix[2][0]};
 
    int *pArray2[3] = {*matrix, *(matrix + 1), *(matrix + 2)};      // pArray2等价于pArray。
 
    show(pArray, 3, 6);
 
    show(pArray2, 3, 6);
 
    system("PAUSE");
    return 0;
}
```

### 3、传递一个【指针，指向一个整数（matrix[0][0]）本身】
```C
#include <stdio.h>
#include <stdlib.h> 
void show(int *p, int rowCnt, int colCnt) {
    for (int i = 0; i <= rowCnt - 1; i++) {
        for (int j = 0; j <= colCnt - 1; j++) {
            int idx = i * colCnt + j;
            printf("%d ", *(p + idx));
        }
        printf("\n");
    }
}
int main() {
 
    int matrix[3][6] = {{1, 2, 3, 4, 5, 6}, {10, 11, 12, 13, 14, 15}, {20, 21, 22, 23}};
 
    // matrix在内存中的值：
    // 1  2  3  4  5  6 
    // 10 11 12 13 14 15
    // 20 21 22 23 0  0  [不确定值]
 
    printf("%d %d\n", sizeof(matrix), sizeof(int));  // 72 4
    
    for (int i = 0; i <= 3 - 1; i++) {
        for (int j = 0; j <= 6 - 1; j++) {
            printf("%d ", &matrix[i][j]);
        }
        printf("\n");
    }
 
    // matrix在内存中的地址：
    // 6422144 6422148 6422152 6422156 6422160 6422164
    // 6422168 6422172 6422176 6422180 6422184 6422188
    // 6422192 6422196 6422200 6422204 6422208 6422212  [6422216]
  
    show(&matrix[0][0], 3, 6);          // OK，直接把matrix[0][0]的地址取出来，传过去。
 
    show(*matrix, 3, 6);                // OK，间接访问，获得指针的值：matrix[0]。数组名：指向数组的第一个元素的指针，即指向matrix[0][0]的指针。
 
    show((int *)matrix, 3, 6);          // OK，直接把matrix强转为int*。
 
    system("PAUSE");
    return 0;
}
```





